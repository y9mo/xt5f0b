---
- name: Install Xorg base
  become: true
  pacman:
    name:
    - xorg-server
    - xorg-xinit
    - xorg-xrdb
    - rxvt-unicode
    - xclip
    state: present

- name: Install xdg-user-dirs tool
  become: true
  pacman:
    name:
      - xdg-user-dirs
    state: present

- name: Creating user's default directories
  shell: xdg-user-dirs-update

- name: Install i3
  become: true
  pacman:
    name:
      - i3-wm
      - i3lock
      - dmenu
      - feh
    state: present

- name: Install polybar
  aur:
    use: yay
    name:
      - nerd-fonts-inconsolata
      - nerd-fonts-noto
      - nerd-fonts-source-code-pro
      - polybar
      - ttf-unifont
    skip_installed: yes

- name: Create polybar/i3 config directory if it does not exist
  file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  with_items: [
    "/home/{{ user.name }}/.config/i3",
    "/home/{{ user.name }}/.config/polybar"
  ]

- name: Launch feh to set wallpaper in i3-wm
  lineinfile:
    path: "/home/{{ user.name }}/.config/i3/config"
    line: "\nexec --no-startup-id feh --bg-scale /home/{{ user.name }}/Pictures/backgrounds/{{ user.wallpaper }}"

- name: Launch polybar in i3-wm
  lineinfile:
    path: "/home/{{ user.name }}/.config/i3/config"
    line: "\nexec_always --no-startup-id /home/{{ user.name }}/.config/polybar/launch.sh"

- name: Install SDDM
  become: true
  pacman:
    name:
      - sddm
      - qt5-svg
    state: present

- name: Install SDDM Theme
  aur:
    use: yay
    name:
      - chili-sddm-theme
    skip_installed: yes

- name: Specify SDDM greeter theme
  become: true
  lineinfile:
    path: /etc/sddm.conf.d/sddm.conf
    regexp: "^Current="
    line: "[Theme]\nCurrent=chili"
    state: present
    create: yes

- name: Set user profile pic
  become: true
  copy:
    src: icon/mask.png
    dest: /usr/share/sddm/faces/{{ user.name }}.face.icon

- name: Copy background
  copy:
    src: backgrounds
    dest: /home/{{ user.name }}/Pictures

- name: Enable SDDM
  become: true
  service:
    name: sddm.service
    enabled: yes

- name: Perl extension keyboad-select for the rxvt-unicode terminal emulator
  become: true
  get_url:
    url: https://raw.githubusercontent.com/muennich/urxvt-perls/master/keyboard-select
    dest: "/usr/lib/urxvt/perl/keyboard-select"
